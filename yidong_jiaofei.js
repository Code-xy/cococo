/**
 * ç§»åŠ¨ç¼´è´¹æŸ¥è¯¢æ‹¦æˆªè„šæœ¬ (getPayFeesQueryInfo)
 * åŠŸèƒ½ï¼šæ‹¦æˆªç§»åŠ¨ç¼´è´¹æŸ¥è¯¢APIï¼Œè¿”å›åç«¯ä¿®æ”¹åçš„åŠ å¯†å“åº”
 * ä½¿ç”¨ï¼šscript-response-body
 * 
 * ç‰¹ç‚¹ï¼šåç«¯è‡ªåŠ¨è¿›è¡ŒAESåŠ å¯†ï¼Œæ— éœ€è„šæœ¬å¤„ç†åŠ å¯†é€»è¾‘
 */

const SERVER_URL = 'http://192.168.240.68:8005';

// ============================================================
// æ—¥å¿—å‡½æ•°
// ============================================================
function log(message) {
    console.log(`[ç§»åŠ¨ç¼´è´¹æŸ¥è¯¢] ${message}`);
}

// ============================================================
// ä¸»é€»è¾‘
// ============================================================
(async function main() {
    try {
        log("============================================================");
        log("ğŸ’³ æ‹¦æˆªåˆ°ç§»åŠ¨ç¼´è´¹æŸ¥è¯¢å“åº”ï¼Œå‡†å¤‡æ›¿æ¢");
        log("============================================================");

        // è¯·æ±‚åç«¯è·å–åŠ å¯†åçš„ç¼´è´¹æŸ¥è¯¢å“åº”
        log(`ğŸ“¡ è¯·æ±‚åç«¯: ${SERVER_URL}/api/yidong/payfees_proxy`);

        const response = await new Promise((resolve, reject) => {
            $task.fetch({
                url: `${SERVER_URL}/api/yidong/payfees_proxy`,
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => {
                resolve(response);
            }).catch(error => {
                reject(error);
            });
        });

        log(`âœ… åç«¯å“åº”çŠ¶æ€: ${response.statusCode}`);

        if (response.statusCode === 200) {
            log(`ğŸ“¦ å“åº”å†…å®¹ç±»å‹: ${response.headers['Content-Type'] || response.headers['content-type'] || 'æœªçŸ¥'}`);
            log(`ğŸ“¦ å“åº”ä½“é•¿åº¦: ${response.body.length} å­—ç¬¦`);
            log(`ğŸ“¦ å“åº”ä½“å‰100å­—ç¬¦: ${response.body.substring(0, 100)}`);
            log(`ğŸ“¦ å“åº”ä½“å®Œæ•´å†…å®¹: ${response.body}`);
            log(`ğŸ” å“åº”å·²ç”±åç«¯AESåŠ å¯†`);
            log(`ğŸ‰ æˆåŠŸï¼è¿”å›åŠ å¯†åçš„ç§»åŠ¨ç¼´è´¹æŸ¥è¯¢æ•°æ®`);
            log("============================================================");
            
            // ç›´æ¥è¿”å›åç«¯çš„åŠ å¯†å“åº”
            $done({ body: response.body });
            return;
        } else {
            log(`âš ï¸ åç«¯è¿”å›çŠ¶æ€ç : ${response.statusCode}`);
            log(`âš ï¸ é”™è¯¯å“åº”å†…å®¹: ${response.body}`);
        }

        // å¦‚æœåç«¯å¤±è´¥ï¼Œè¿”å›åŸå§‹å“åº”
        log("ğŸ’¡ åç«¯å¤±è´¥ï¼Œè¿”å›åŸå§‹å“åº”");
        log("============================================================");
        $done({});

    } catch (error) {
        log(`âŒ è„šæœ¬æ‰§è¡Œå‡ºé”™: ${error.message || error}`);
        log("============================================================");
        $done({});
    }
})();

