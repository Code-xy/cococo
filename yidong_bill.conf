# Quantumult X 配置 - 移动账单拦截
# 功能：拦截移动账单API，解密提取手机号，返回后端AES加密后的响应

[rewrite_local]
# 移动账单响应拦截
# 说明：拦截移动账单查询API，支持多种可能的账单API路径
^https://clientaccess\.10086\.cn/biz-orange/BN/userInformationService/getUserInformation url script-response-body https://raw.githubusercontent.com/Code-xy/cococo/refs/heads/main/yidong_get_phone.js
^https://app\.10086\.cn/biz-orange/BN/payFeesHistory/getPayFeesHistory url script-response-body https://raw.githubusercontent.com/Code-xy/cococo/refs/heads/main/yidong_bill.js

[mitm]
# MITM 主机名配置
hostname = clientaccess.10086.cn, app.10086.cn

# ============================================================
# 使用说明
# ============================================================
# 1. 后端管理：
#    - 启动：python unified_backend.py
#    - 地址：http://你的IP:8005/yidong.html
#    - 修改脚本中的 SERVER_URL 为你的后端地址
#
# 2. 配置步骤：
#    ① 启动统一后端服务
#    ② 打开移动管理界面添加账户
#    ③ 编辑账单响应JSON并保存
#    ④ 导入此配置到 Quantumult X
#    ⑤ 更新脚本中的 SERVER_URL（如使用公网，改为公网地址）
#    ⑥ 打开移动App测试账单查询
#
# 3. 工作原理：
#    - 圈X拦截移动账单响应（加密的）
#    - 调用后端解密接口提取手机号
#    - 请求后端 /api/yidong/proxy?phone=xxx 获取修改后的响应
#    - 后端自动AES加密并返回
#    - 圈X替换原始响应
#
# 4. 加密说明：
#    - 后端自动进行AES加密
#    - 账单使用Key: UVic06tpXgMNiApm
#    - IV: 9791027341711819
#
# 5. 账户匹配：
#    - 优先使用从响应中提取的手机号匹配
#    - 如果提取失败，使用后端默认匹配策略（单个账户自动使用）
# ============================================================
